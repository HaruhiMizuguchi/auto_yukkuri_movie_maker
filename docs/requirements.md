# ゆっくり動画 自動生成ツール　要件定義書（全文・改訂版）

---

## 1. 概要
本ツールは、**企画からYouTube投稿までをワンストップで自動化**し、  
「ゆっくり動画」（霊夢・魔理沙などの立ち絵と合成音声による解説／雑談動画）を生成します。  
AI / LLM / TTS / 画像生成モデルを連携させ、ユーザーの操作は最小限に抑えつつも  
**"見やすく・聞きやすく・処理が止まらない" 品質を保証**します。  
二次創作ガイドライン（東方Project 等）、YouTube 利用規約、著作権法を順守することを前提とします。

---

## 2. 機能概要

| #  | 機能 | 主な技術 |
|----|------|----------|
| 1  | **テーマ選定**（自動／手動） | LLM（トレンド考慮） |
| 2  | **スクリプト生成**（長さ・話者数指定） | LLM |
| 3  | **タイトル生成**（クリック率重視） | LLM |
| 4  | **音声生成（TTS）**<br> ‑ 話者プリセット（霊夢／魔理沙）<br> ‑ ワード単位タイムスタンプ取得 | AIVIS Speech API |
| 5  | **ゆっくり立ち絵自動合成**<br> ‑ 口パク同期・表情切替 | 画像スプライト + FFmpeg |
| 6  | **背景画像生成**（n 秒ごと） | 画像生成AI |
| 7  | **背景画像へ動き付与**（パン・ズーム等） | FFmpeg / OpenCV |
| 8  | **字幕生成・適用**<br> ‑ 縁取り・自動折り返し・強調色 | TTSタイムスタンプ + FFmpeg |
| 9  | **効果音 & BGM 挿入**<br> ‑ 自動選定・音量正規化・フェード | 効果音ライブラリ + SoX |
| 10 | **メイン画像（挿絵）生成**（話題転換点に挿入） | 画像生成AI |
| 11 | **動画書き出し・エンコード**<br> ‑ 解像度 / FPS / ビットレート プリセット<br> ‑ 失敗時リトライ | FFmpeg |
| 12 | **YouTube 自動投稿**（タイトル・説明・タグ） | YouTube Data API |
| 13 | **エラーハンドリング**（各工程で再試行・通知） | ログ + Webhook |

---

## 3. 機能詳細

### 3.1 テーマ選定
- LLM が視聴者にウケるテーマ候補を生成。  
- 過去動画のジャンル履歴を保持し、**「同じジャンルを優先／除外」**の切替が可能。  
- 自動決定と手動入力をユーザーが選択できる。

---

### 3.2 スクリプト生成
- テーマを入力として LLM がスクリプトを生成。  
- **動画尺（例：5 分 / 10 分）**と**話者形式（1人語り or 2人掛け合い）**を指定可能。  

---

### 3.3 視聴者を惹きつけるタイトル生成
- テーマとスクリプトを基に LLM が高 CTR を狙ったタイトル候補を多数出力。  
- 自動採用／手動編集を切替え可能。

---

### 3.4 音声生成（TTS）
1. スクリプトを AIVIS Speech に送り、**霊夢用・魔理沙用などの声質プリセット**で読み上げ。  
2. API から取得できる**ワード／音素単位のタイムスタンプ**を保存。  
3. ピッチ・話速・感情（通常／怒り／喜び）をセリフ長さや内容に応じて自動調整。  

---

### 3.5 ゆっくり立ち絵自動合成
- 立ち絵のスプライト（口開閉2枚 × 表情4種）を用意。
- 立ち絵を使用するかしないかを選択可能。
- 使用する場合、 **TTS タイムスタンプで口パクを同期**、LLM が推定した感情で表情を切替え。  
- 立ち絵レイヤーを後段の動画に合成する。

---

### 3.6 背景画像生成
- 動画尺 ÷ **切替間隔 n 秒** の枚数を画像生成AIで生成。  
- ストーリー性を持たせる場合は LLM が簡単な物語を設計。

---

### 3.7 背景画像に動きを付与
- Ken Burns（パン／ズーム）、左右スライド、拡大縮小など複数パターンを実装。  
- 各画像にランダムまたは LLM 提案の動きを n 秒間適用し、連結して **動画A** を作成。  

---

### 3.8 字幕生成・適用
1. 字幕スタイル：基本は白字＋黒縁、フォントサイズは画面解像度から自動算出。
2. フォントや色、縁取りなどは設定可能。
3. スクリプトを**意味段落ごとに分割**し、ワードタイムスタンプと照合。  
4. 行長を自動折り返し、**重要語を色変え**（赤字など）。  
5. 字幕を動画A + 立ち絵(使用する場合) + 音声の **動画B** に焼き込み。

---

### 3.9 効果音 & BGM 挿入
- 字幕切替点やキーワード出現点に SE を配置。  
- ライブラリをタグ検索し、**同一 SE の連続使用を回避**。  
- BGM をジャンルに合わせ自動選定し、**音量正規化・フェードイン／アウト**を適用。  
- ミキシング後、**動画C** を生成。

---

### 3.10 メイン画像（挿絵）生成
- 字幕の話題転換を LLM が判定し、その箇所数だけ説明図・例示画像などを生成。  
- 動きを付けず、対応するタイミングで動画C に挿入して **動画D** を作成。

---

### 3.11 動画書き出し・エンコード
- プリセット例：  
  - **横動画**：1920×1080 / 30 fps / 8 Mbps H.264  
  - **縦動画**：1080×1920 / 60 fps / 10 Mbps H.264  
- 書き出し失敗時は **最大3回自動リトライ**。途中まで成功している場合は断点から再開。  
- 完成ファイル（MP4）を **動画E** とする。

---

### 3.12 YouTube 自動投稿
- YouTube Data API で OAuth 認証し、  
  タイトル・説明文・タグ・公開設定・公開予約時刻を自動入力。  
- 投稿完了後、動画URL をログに保存。

---

### 3.13 エラーハンドリング
- 各ステップで例外を捕捉し、  
  1. 自動リトライ → 2. スキップ → 3. **最終結果とエラー詳細をファイルに保存。  
- ログは JSON + ローテーションファイルで保存し、後続分析に利用。

---

## 4. 品質保証とガイドライン遵守
| 項目 | 対応 |
|------|------|
| 著作権・ライセンス | 効果音・BGM・立ち絵・画像モデルは商用利用可ライセンスを選択。CC BY 等は自動クレジット表記。 |
| 二次創作規定 | 東方Project の二次創作ガイドライン範囲内でのみ立ち絵を使用。 |
| 音量基準 | LUFS(‑14±1) に自動ノーマライズ。 |
| コミュニティガイドライン | LLM 生成テキストを自動フィルタ（暴力・ヘイトワード）。 |

---

## 5. UI・操作フロー（簡易）
1. **新規プロジェクト作成**  
2. テーマ自動提案 → 必要に応じて編集  
3. 動画尺・話者数・背景切替間隔などを入力（初期値あり）  
4. 「生成開始」を押すと全パイプライン実行  
5. 完成プレビューを確認 → OK ならアップロード実行  

---

## 6. 技術仕様
- 開発言語: Python 3.8+
- 主要ライブラリ: FFmpeg, OpenCV, SoX
- API: AIVIS Speech API, YouTube Data API, 各種AI/LLMサービス
- データベース: SQLite（ローカル）/ PostgreSQL（本番）
- 設定管理: YAML / JSON
- ログ: 構造化ログ（JSON形式）

---

## 7. 今後の拡張予定
- 多言語対応（英語字幕生成）
- リアルタイム配信対応
- 視聴者コメント反映機能
- A/Bテスト機能（タイトル・サムネイル）
- クラウド版の提供 